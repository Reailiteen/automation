{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/majedahalshorman/Desktop/Side-Projects/automation/apps/web/apps/web/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from \"@supabase/ssr\";\n\nexport function createClient() {\n  const supabaseUrl = (process.env.NEXT_PUBLIC_SUPABASE_URL ?? \"\").trim();\n  const supabaseAnonKey = (process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ?? \"\").trim();\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\n      \"Missing Supabase env: NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY\"\n    );\n  }\n\n  return createBrowserClient(supabaseUrl, supabaseAnonKey);\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACd,MAAM,cAAc,CAAC,gFAAwC,EAAE,EAAE,IAAI;IACrE,MAAM,kBAAkB,CAAC,wPAA6C,EAAE,EAAE,IAAI;IAE9E,IAAI,CAAC,eAAe,CAAC,iBAAiB;QACpC,MAAM,IAAI,MACR;IAEJ;IAEA,OAAO,IAAA,8SAAmB,EAAC,aAAa;AAC1C"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///Users/majedahalshorman/Desktop/Side-Projects/automation/apps/web/apps/web/lib/firebase/client.ts"],"sourcesContent":["import { FirebaseApp, getApp, getApps, initializeApp } from \"firebase/app\";\n\nfunction getFirebaseConfig() {\n  const apiKey = process.env.NEXT_PUBLIC_FIREBASE_API_KEY;\n  const authDomain = process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN;\n  const projectId = process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID;\n  const storageBucket = process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET;\n  const messagingSenderId = process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID;\n  const appId = process.env.NEXT_PUBLIC_FIREBASE_APP_ID;\n  const measurementId = process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID;\n\n  if (\n    !apiKey ||\n    !authDomain ||\n    !projectId ||\n    !storageBucket ||\n    !messagingSenderId ||\n    !appId\n  ) {\n    throw new Error(\n      \"Missing Firebase env vars. Set NEXT_PUBLIC_FIREBASE_* values in apps/web/apps/web/.env.local\"\n    );\n  }\n\n  return {\n    apiKey,\n    authDomain,\n    projectId,\n    storageBucket,\n    messagingSenderId,\n    appId,\n    measurementId,\n  };\n}\n\nexport function getFirebaseApp(): FirebaseApp {\n  if (getApps().length > 0) {\n    return getApp();\n  }\n\n  return initializeApp(getFirebaseConfig());\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEA,SAAS;IACP,MAAM;IACN,MAAM;IACN,MAAM;IACN,MAAM;IACN,MAAM;IACN,MAAM;IACN,MAAM;IAEN;;IAaA,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;AAEO,SAAS;IACd,IAAI,IAAA,0OAAO,IAAG,MAAM,GAAG,GAAG;QACxB,OAAO,IAAA,yOAAM;IACf;IAEA,OAAO,IAAA,gPAAa,EAAC;AACvB"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/majedahalshorman/Desktop/Side-Projects/automation/apps/web/apps/web/lib/firebase/messaging.ts"],"sourcesContent":["import { MessagePayload, getMessaging, getToken, isSupported, onMessage } from \"firebase/messaging\";\nimport { getFirebaseApp } from \"@/lib/firebase/client\";\n\nexport type WebPushTokenResult =\n  | { ok: true; token: string }\n  | { ok: false; reason: string };\n\nlet foregroundHandlerAttached = false;\n\nasync function getServiceWorkerRegistration() {\n  if (typeof window === \"undefined\" || !(\"serviceWorker\" in navigator)) {\n    return null;\n  }\n\n  return navigator.serviceWorker.register(\"/firebase-messaging-sw.js\");\n}\n\nexport async function requestWebPushToken(): Promise<WebPushTokenResult> {\n  if (typeof window === \"undefined\") {\n    return { ok: false, reason: \"browser-only\" };\n  }\n\n  const supported = await isSupported().catch(() => false);\n  if (!supported) {\n    return { ok: false, reason: \"messaging-not-supported\" };\n  }\n\n  if (Notification.permission === \"denied\") {\n    return { ok: false, reason: \"notifications-denied\" };\n  }\n\n  const vapidKey = process.env.NEXT_PUBLIC_FIREBASE_VAPID_KEY;\n  if (!vapidKey) {\n    return { ok: false, reason: \"missing-vapid-key\" };\n  }\n\n  const permission =\n    Notification.permission === \"granted\"\n      ? \"granted\"\n      : await Notification.requestPermission();\n  if (permission !== \"granted\") {\n    return { ok: false, reason: \"notifications-not-granted\" };\n  }\n\n  const registration = await getServiceWorkerRegistration();\n  if (!registration) {\n    return { ok: false, reason: \"service-worker-unavailable\" };\n  }\n\n  const messaging = getMessaging(getFirebaseApp());\n  const token = await getToken(messaging, {\n    vapidKey,\n    serviceWorkerRegistration: registration,\n  });\n\n  if (!token) {\n    return { ok: false, reason: \"empty-token\" };\n  }\n\n  return { ok: true, token };\n}\n\nexport async function attachForegroundMessageHandler(\n  onPayload?: (payload: MessagePayload) => void\n) {\n  if (foregroundHandlerAttached) {\n    return;\n  }\n\n  const supported = await isSupported().catch(() => false);\n  if (!supported) {\n    return;\n  }\n\n  foregroundHandlerAttached = true;\n  const messaging = getMessaging(getFirebaseApp());\n\n  onMessage(messaging, (payload) => {\n    onPayload?.(payload);\n  });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAMA,IAAI,4BAA4B;AAEhC,eAAe;IACb,IAAI,kDAAkB,eAAe,CAAC,CAAC,mBAAmB,SAAS,GAAG;QACpE,OAAO;IACT;;;AAGF;AAEO,eAAe;IACpB,wCAAmC;QACjC,OAAO;YAAE,IAAI;YAAO,QAAQ;QAAe;IAC7C;;;IAEA,MAAM;IASN,MAAM;IAKN,MAAM;IAQN,MAAM;IAKN,MAAM;IACN,MAAM;AAUR;AAEO,eAAe,+BACpB,SAA6C;IAE7C,IAAI,2BAA2B;QAC7B;IACF;IAEA,MAAM,YAAY,MAAM,IAAA,+RAAW,IAAG,KAAK,CAAC,IAAM;IAClD,IAAI,CAAC,WAAW;QACd;IACF;IAEA,4BAA4B;IAC5B,MAAM,YAAY,IAAA,gSAAY,EAAC,IAAA,yKAAc;IAE7C,IAAA,6RAAS,EAAC,WAAW,CAAC;QACpB,YAAY;IACd;AACF"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/majedahalshorman/Desktop/Side-Projects/automation/apps/web/apps/web/lib/firebase/register-web-push.ts"],"sourcesContent":["import { attachForegroundMessageHandler, requestWebPushToken } from \"@/lib/firebase/messaging\";\n\nconst LAST_REGISTERED_TOKEN_KEY = \"automation:last-registered-fcm-token\";\n\nexport type RegisterPushResult =\n  | { ok: true; token: string; skipped: boolean }\n  | { ok: false; reason: string };\n\nasync function saveTokenToServer(token: string) {\n  const response = await fetch(\"/api/notifications/fcm-token\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({\n      token,\n      platform: \"web\",\n      userAgent: navigator.userAgent,\n    }),\n  });\n\n  if (!response.ok) {\n    const body = await response.json().catch(() => ({}));\n    const message =\n      typeof body?.error === \"string\"\n        ? body.error\n        : \"Failed to register push token\";\n    throw new Error(message);\n  }\n}\n\nexport async function registerWebPush({\n  force = false,\n  userId,\n}: { force?: boolean; userId?: string } = {}): Promise<RegisterPushResult> {\n  const tokenResult = await requestWebPushToken();\n  if (!tokenResult.ok) {\n    return tokenResult;\n  }\n\n  const { token } = tokenResult;\n  const storageKey = userId\n    ? `${LAST_REGISTERED_TOKEN_KEY}:${userId}`\n    : LAST_REGISTERED_TOKEN_KEY;\n\n  if (typeof window !== \"undefined\") {\n    await attachForegroundMessageHandler((payload) => {\n      console.info(\"Foreground push payload:\", payload);\n    });\n  }\n\n  const previousToken =\n    typeof window === \"undefined\"\n      ? null\n      : window.localStorage.getItem(storageKey);\n\n  if (!force && previousToken === token) {\n    return { ok: true, token, skipped: true };\n  }\n\n  await saveTokenToServer(token);\n\n  if (typeof window !== \"undefined\") {\n    window.localStorage.setItem(storageKey, token);\n  }\n\n  return { ok: true, token, skipped: false };\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,4BAA4B;AAMlC,eAAe,kBAAkB,KAAa;IAC5C,MAAM,WAAW,MAAM,MAAM,gCAAgC;QAC3D,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;QACA,MAAM,KAAK,SAAS,CAAC;YACnB;YACA,UAAU;YACV,WAAW,UAAU,SAAS;QAChC;IACF;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,OAAO,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAClD,MAAM,UACJ,OAAO,MAAM,UAAU,WACnB,KAAK,KAAK,GACV;QACN,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,gBAAgB,EACpC,QAAQ,KAAK,EACb,MAAM,EAC+B,GAAG,CAAC,CAAC;IAC1C,MAAM,cAAc,MAAM,IAAA,iLAAmB;IAC7C,IAAI,CAAC,YAAY,EAAE,EAAE;QACnB,OAAO;IACT;IAEA,MAAM,EAAE,KAAK,EAAE,GAAG;IAClB,MAAM,aAAa,SACf,GAAG,0BAA0B,CAAC,EAAE,QAAQ,GACxC;IAEJ;;IAMA,MAAM,gBACJ,uCACI,OACA;IAEN,IAAI,CAAC,SAAS,kBAAkB,OAAO;QACrC,OAAO;YAAE,IAAI;YAAM;YAAO,SAAS;QAAK;IAC1C;IAEA,MAAM,kBAAkB;IAExB;;IAIA,OAAO;QAAE,IAAI;QAAM;QAAO,SAAS;IAAM;AAC3C"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///Users/majedahalshorman/Desktop/Side-Projects/automation/apps/web/apps/web/components/auth/auth-provider.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  createContext,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  type ReactNode,\n} from \"react\";\nimport type { User } from \"@supabase/supabase-js\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { registerWebPush } from \"@/lib/firebase/register-web-push\";\n\ninterface AuthContextValue {\n  user: User | null;\n  loading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextValue | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const pushRegistrationForUserRef = useRef<string | null>(null);\n  const supabase = useMemo(() => createClient(), []);\n\n  useEffect(() => {\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setUser(session?.user ?? null);\n      setLoading(false);\n    });\n\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      setUser(session?.user ?? null);\n      setLoading(false);\n    });\n\n    return () => subscription.unsubscribe();\n  }, [supabase]);\n\n  useEffect(() => {\n    if (!user) {\n      pushRegistrationForUserRef.current = null;\n      return;\n    }\n\n    if (pushRegistrationForUserRef.current === user.id) {\n      return;\n    }\n    pushRegistrationForUserRef.current = user.id;\n\n    registerWebPush({ userId: user.id }).then((result) => {\n      if (!result.ok) {\n        console.info(\"Web push registration skipped:\", result.reason);\n        return;\n      }\n\n      if (!result.skipped) {\n        console.info(\"Web push token registered for user.\");\n      }\n    }).catch((error) => {\n      console.error(\"Web push registration failed:\", error);\n    });\n  }, [user]);\n\n  return (\n    <AuthContext.Provider value={{ user, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth(): AuthContextValue {\n  const ctx = useContext(AuthContext);\n  if (ctx === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAUA;AACA;AAbA;;;;;AAoBA,MAAM,4BAAc,IAAA,2aAAa,EAA+B;AAEzD,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,saAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,saAAQ,EAAC;IACvC,MAAM,6BAA6B,IAAA,oaAAM,EAAgB;IACzD,MAAM,WAAW,IAAA,qaAAO,EAAC,IAAM,IAAA,uKAAY,KAAI,EAAE;IAEjD,IAAA,uaAAS,EAAC;QACR,MAAM,EACJ,MAAM,EAAE,YAAY,EAAE,EACvB,GAAG,SAAS,IAAI,CAAC,iBAAiB,CAAC,CAAC,QAAQ;YAC3C,QAAQ,SAAS,QAAQ;YACzB,WAAW;QACb;QAEA,SAAS,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;YACpD,QAAQ,SAAS,QAAQ;YACzB,WAAW;QACb;QAEA,OAAO,IAAM,aAAa,WAAW;IACvC,GAAG;QAAC;KAAS;IAEb,IAAA,uaAAS,EAAC;QACR,IAAI,CAAC,MAAM;YACT,2BAA2B,OAAO,GAAG;YACrC;QACF;QAEA,IAAI,2BAA2B,OAAO,KAAK,KAAK,EAAE,EAAE;YAClD;QACF;QACA,2BAA2B,OAAO,GAAG,KAAK,EAAE;QAE5C,IAAA,2LAAe,EAAC;YAAE,QAAQ,KAAK,EAAE;QAAC,GAAG,IAAI,CAAC,CAAC;YACzC,IAAI,CAAC,OAAO,EAAE,EAAE;gBACd,QAAQ,IAAI,CAAC,kCAAkC,OAAO,MAAM;gBAC5D;YACF;YAEA,IAAI,CAAC,OAAO,OAAO,EAAE;gBACnB,QAAQ,IAAI,CAAC;YACf;QACF,GAAG,KAAK,CAAC,CAAC;YACR,QAAQ,KAAK,CAAC,iCAAiC;QACjD;IACF,GAAG;QAAC;KAAK;IAET,qBACE,mcAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;QAAQ;kBAC1C;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,MAAM,IAAA,waAAU,EAAC;IACvB,IAAI,QAAQ,WAAW;QACrB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}}]
}